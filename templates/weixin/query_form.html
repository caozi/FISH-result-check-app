<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
        <title>查询</title>
        <!-- 引入 WeUI CDN 链接 -->
        <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.3.0/weui.min.css"/>
    </head>
    <body>
        <form action="/weixin/query/" method="post" id="form" onsubmit="return false">
            <div class="page">
                <div class="weui-form">
                    <div class="weui-form__text-area">
                        <h2 class="weui-form__title">查询</h2>
                    </div>
                    <div class="weui-form__control-area">
                        <div class="weui-cells__group weui-cells__group_form">
                            <div class="weui-cells weui-cells_form">
                                <div class="weui-cell weui-cell_active">
                                    <div class="weui-cell__hd">
                                        <label class="weui-label">会诊号</label>
                                    </div>
                                    <div class="weui-cell__hd" id='HZ'>
                                        HZ
                                    </div>
                                    <div class="weui-cell__bd" >
                                        <input name="patient_id" id="patient_id" class="weui-input" placeholder="填写会诊号" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="weui-form__opr-area">
                        <button type="submit" class="weui-btn weui-btn_primary" id="check">查询</button>
                    </div>
                    <div class="weui-form__extra-area">
                        <div class="weui-footer">
                            <p class="weui-footer__text">Copyright © 2020 天津市肿瘤医院病理科</p>
                        </div>
                    </div>
                </div>
            </div>
            <!--BEGIN warn toast-->
            <div id="toast" style="display: none;">
                <div class="weui-mask_transparent"></div>
                <div class="weui-toast">
                    <i class="weui-icon-success-no-circle weui-icon_toast"></i>
                    <p class="weui-toast__content" id="warn_tip"></p>
                </div>
            </div>
            <!--end warn toast-->
            <!-- loading toast -->
            <div id="loadingToast" style="display: none;">
                <div class="weui-mask_transparent"></div>
                <div class="weui-toast">
                    <i class="weui-loading weui-icon_toast"></i>
                    <p class="weui-toast__content">会诊号校验中</p>
                </div>
            </div>
            <!--end toast-->
        </form>
    </body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
    <script type="text/javascript">
      $(function(){
                var $patient_id = $('#patient_id');
                var $check = $('#check');
                var $toast = $('#toast');
                var $loadingToast = $('#loadingToast');
                var $warn_tip = $('#warn_tip');

                $check.on('click', function(){
                    if($patient_id.val()){
                        $loadingToast.show();
                        $.ajax({
                        url: '/weixin/check_patient_id/',
                        data: {
                            'patient_id': $patient_id.val()
                        },
                        dataType: 'json',
                        success: function (data) {
                            if (data.exist) {
                                $('#form')[0].submit();
                                return true;
                            }else{
                                $warn_tip.text("会诊号不存在，请检查会诊号");
                                $toast.fadeIn(100);
                                setTimeout(function () {
                                    $toast.fadeOut(100);
                                }, 2000);
                                $patient_id.val('').focus();
                                return false;
                            }
                        },
                        complete: function(){
                            $loadingToast.hide();
                        }
                    });
                    }else{
                        $warn_tip.text("请输入会诊号");
                        $toast.fadeIn(100);
                        setTimeout(function () {
                            $toast.fadeOut(100);
                         }, 2000);
                         $patient_id.focus();
                         return false;
                    }
                });
        });
      </script>
</html>

